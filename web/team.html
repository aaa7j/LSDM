<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Team</title>
    <link rel="stylesheet" href="/static/app.css?v=team2" />
  </head>
  <body>
    <div class="topbar"><div class="inner"><a class="brand" href="/" onclick="if (location.protocol==='file:'){location.href='index.html'; return false;}">NBA Search</a><div class="nav"><a href="/">Search</a><a href="/predict-ui">Predict</a></div></div></div>
    <div class="wrap"><div id="content">Loading...</div>
      <footer style="margin: 28px 0; color: var(--muted); font-size: 12px;">Minimal UI. Results powered by the local FastAPI service.</footer>
    </div>
    <script src="/static/app.js?v=team2"></script>
<script>
  function getId(){
    const m=location.pathname.match(/\/team\/(.+)$/);
    if(m) return decodeURIComponent(m[1]);
    const u=new URL(location.href);
    return u.searchParams.get('id');
  }
  function initials(s){
    const t=(s||'').trim().split(/\s+/).filter(Boolean); if(!t.length) return '';
    return t.map(w=>w[0]).join('').slice(0,3).toUpperCase();
  }
  async function load(){
    const id=getId(); const el=document.getElementById('content');
    if(!id){ el.textContent='Missing team id'; return; }
    try{
      if (window.setLoading) setLoading(el, true, 'Loadingâ€¦');
      const res=await fetch(`/entity/team/${encodeURIComponent(id)}`);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const d=await res.json();
      if(d.error){ el.textContent=d.error; return; }

      const box=document.createElement('div'); box.className='team-card';

      // Header: avatar + title + tags
      const head=document.createElement('div'); head.className='team-head';
      const abbr=(d.abbreviation || initials(d.name) || (d.city? d.city[0] : d.id || '?')).toString().toUpperCase();
      const avatar=document.createElement('div'); avatar.className='team-avatar'; avatar.textContent=abbr; head.appendChild(avatar);
      const headInfo=document.createElement('div'); headInfo.className='team-head-info';
      const title=document.createElement('div'); title.className='team-name'; title.textContent=(d.full_name||d.name||d.id);
      const sub=document.createElement('div'); sub.className='team-sub'; sub.textContent=(d.city||'');
      const tags=document.createElement('div'); tags.className='team-tags';
      if(d.conference){ const t=document.createElement('span'); t.className='tag'; t.textContent=d.conference; tags.appendChild(t); }
      if(d.division){ const t=document.createElement('span'); t.className='tag'; t.textContent=d.division; tags.appendChild(t); }
      headInfo.appendChild(title); if(sub.textContent) headInfo.appendChild(sub); if(tags.children.length) headInfo.appendChild(tags);
      head.appendChild(headInfo); box.appendChild(head);

      // Meta chips (without State)
      const meta=document.createElement('div'); meta.className='team-meta';
      const mkChip=(label,val)=>{ const s=document.createElement('span'); s.className='meta-chip'; s.textContent = `${label}: ${val||'-'}`; return s; };
      meta.appendChild(mkChip('Arena', d.arena));
      if (d.arena_capacity!=null && d.arena_capacity!=='') meta.appendChild(mkChip('Cap', d.arena_capacity));
      box.appendChild(meta);

      // Informazioni: cards grid side-by-side
      const infoItems = [];
      if (d.abbreviation) infoItems.push(['Abbreviazione', d.abbreviation]);
      if (d.nickname) infoItems.push(['Nickname', d.nickname]);
      if (d.year_founded) infoItems.push(['Fondazione', String(d.year_founded)]);
      if (d.owner) infoItems.push(['Proprietario', d.owner]);
      if (d.general_manager) infoItems.push(['GM', d.general_manager]);
      if (d.head_coach) infoItems.push(['Coach', d.head_coach]);
      if (d.dleague_affiliation) infoItems.push(['G League', d.dleague_affiliation]);
      const socials = [];
      if (d.facebook) socials.push(['Facebook', d.facebook]);
      if (d.instagram) socials.push(['Instagram', d.instagram]);
      if (d.twitter) socials.push(['Twitter', d.twitter]);
      if (infoItems.length || socials.length){
        const sec=document.createElement('section');
        const h2=document.createElement('h2'); h2.className='h2'; h2.textContent='Informazioni'; sec.appendChild(h2);
        if (infoItems.length){
          const list=document.createElement('div'); list.className='info-cards';
          infoItems.forEach(([k,v])=>{
            const card=document.createElement('div'); card.className='info-card';
            const kEl=document.createElement('div'); kEl.className='k'; kEl.textContent=k;
            const vEl=document.createElement('div'); vEl.className='v'; vEl.textContent=v;
            card.appendChild(kEl); card.appendChild(vEl); list.appendChild(card);
          });
          sec.appendChild(list);
        }
        if (socials.length){
          const lbl=document.createElement('div'); lbl.className='muted'; lbl.textContent='Social'; sec.appendChild(lbl);
          const links=document.createElement('div'); links.className='social-chips';
          socials.forEach(([label,url])=>{
            const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noreferrer noopener'; a.textContent=label; a.className='chip';
            links.appendChild(a);
          });
          sec.appendChild(links);
        }
        box.appendChild(sec);
      }

      // Storia: two-column grid (years | name)
      if (Array.isArray(d.history_names) && d.history_names.length){
        const sec=document.createElement('section');
        const h2=document.createElement('h2'); h2.className='h2'; h2.textContent='Storia'; sec.appendChild(h2);
        const list=document.createElement('div'); list.className='history-table';
        d.history_names.forEach(it=>{
          const y1=(it.from!=null? String(it.from):'?'); const y2=(it.to!=null? String(it.to):'presente');
          const years=document.createElement('div'); years.className='cell years'; years.textContent = `${y1}-${y2}`;
          const name=document.createElement('div'); name.className='cell name'; name.textContent = `${(it.city||'')} ${(it.nickname||'')}`.trim();
          list.appendChild(years); list.appendChild(name);
        });
        sec.appendChild(list);
        box.appendChild(sec);
      }

      // Roster (column layout)
      const rosterWrap = document.createElement('section');
      rosterWrap.className='roster';
      const h = document.createElement('h2'); h.className='h2'; h.textContent = `Roster attuale${d.roster_count? ' ('+d.roster_count+')':''}`;
      rosterWrap.appendChild(h);

      if (Array.isArray(d.roster) && d.roster.length){
        const list=document.createElement('div'); list.className='roster-list';
        d.roster.forEach(p=>{
          const row=document.createElement('div'); row.className='player-row';
          const a=document.createElement('a'); a.className='link';
          a.href=(location.protocol==='file:' ? `player.html?id=${encodeURIComponent(p.id)}` : `/player/${encodeURIComponent(p.id)}`);
          const jersey = p.jersey ? ` #${p.jersey}` : '';
          a.textContent = `${p.name || p.id}${p.position ? ' - '+p.position : ''}${jersey}`;
          row.appendChild(a);
          list.appendChild(row);
        });
        rosterWrap.appendChild(list);
      } else {
        const none=document.createElement('div'); none.className='muted'; none.textContent='Nessun giocatore disponibile.';
        rosterWrap.appendChild(none);
      }

      box.appendChild(rosterWrap);
      el.innerHTML=''; if (window.setLoading) setLoading(el, false); el.appendChild(box);
    } catch(e){
      el.textContent='Error: '+(e.message||e);
    }
  }
  load();
</script>

  </body>
  </html>
